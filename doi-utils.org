#+TITLE: DOI utilities for making bibtex entries and downloading pdfs

This package provides functionality to download PDFs and bibtex entries from a DOI, as well as to update a bibtex entry from a DOI. It depends slightly on org-ref, to determine where to save pdf files too, and where to insert bibtex entries in the default bibliography.

The principle commands you will use from here are:

- doi-utils-get-bibtex-entry-pdf with the cursor in a bibtex entry.
- doi-utils-insert-bibtex-entry-from-doi to insert a bibtex entry at your cursor, clean it and try to get a pdf.
- doi-utils-add-bibtex-entry-from-doi to add an entry to your default bibliography (cleaned with pdf if possible).
- doi-utils-add-bibtex-entry-from-region to add an entry from a highlighed doi to your default bibliography.
- doi-utils-update-bibtex-entry-from-doi with cursor in an entry to update its fields.

* Header
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
;;; doi-utils.el --- get bibtex entries and pdfs from a DOI

;; Copyright(C) 2014 John Kitchin

;; Author: John Kitchin <jkitchin@andrew.cmu.edu>
;; This file is not currently part of GNU Emacs.

;; This program is free software; you can redistribute it and/or
;; modify it under the terms of the GNU General Public License as
;; published by the Free Software Foundation; either version 2, or (at
;; your option) any later version.

;; This program is distributed in the hope that it will be useful, but
;; WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
;; General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program ; see the file COPYING.  If not, write to
;; the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
;; Boston, MA 02111-1307, USA.

;;; Commentary:
;;
;; Lisp code to generate and update bibtex entries from a DOI, and to
;; download pdfs from publisher websites from a DOI.
;;
;; Package-Requires: ((org-ref))

(require 'json)
#+END_SRC

* Getting pdf files from a DOI
The idea here is simple. When you visit http://dx.doi.org/doi, you get redirected to the journal site. Once you have the url for the article, you can usually compute the url to the pdf, or find it in the page. Then you simply download it.

There are some subtleties in doing this that are described here. To get the redirect, we have to use url-retrieve, and a callback function. The callback does not return anything, so we communicate through global variables. url-retrieve is asynchronous, so we have to make sure to wait for it to finish.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defvar *doi-utils-waiting* t
  "stores waiting state for url retrieval.")

(defvar *doi-utils-redirect* nil
  "stores redirect url from a callback function")

(defun doi-utils-redirect-callback (&optional status)
  "callback for url-retrieve to set the redirect"
  (when (plist-get status :error)
    (signal (car (plist-get status :error)) (cdr(plist-get status :error))))
  (when (plist-get status :redirect) ;  is nil if there none
    (message "redirects = %s" (plist-get status :redirect))
    (message "*doi-utils-redirect* set to %s"
	     (setq *doi-utils-redirect* (plist-get status :redirect))))
  ;; we have done our job, so we are not waiting any more.
  (setq *doi-utils-waiting* nil))
#+END_SRC

To actually get the redirect we use url-retrieve like this.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-get-redirect (doi)
  "get redirect url from dx.doi.org/doi"
  ;; we are going to wait until the url-retrieve is done
  (setq *doi-utils-waiting* t)
  ;; start with no redirect. it will be set in the callback.
  (setq *doi-utils-redirect* nil)
  (url-retrieve
   (format "http://dx.doi.org/%s" doi)
   'doi-utils-redirect-callback)
  ; I suspect we need to wait here for the asynchronous process to
  ; finish. we loop and sleep until the callback says it is done via
  ; `*doi-utils-waiting*'. this works as far as i can tell. Before I
  ; had to run this a few times to get it to work, which i suspect
  ; just gave the first one enough time to finish.
  (while *doi-utils-waiting* (sleep-for 0.1)))
#+END_SRC

Once we have a redirect for a particular doi, we need to compute the url to the pdf. We do this with a series of functions. Each function takes a single argument, the redirect url. If it knows how to compute the pdf url it does, and returns it. We store the functions in a variable:

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defvar doi-utils-pdf-url-functions nil
  "list of functions that return a url to a pdf from a redirect url. Each function takes one argument, the redirect url. The function must return a pdf-url, or nil.")
#+END_SRC

** APS journals
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun aps-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://journals.aps.org" *doi-utils-redirect*)
    (replace-regexp-in-string "/abstract/" "/pdf/" *doi-utils-redirect*)))
#+END_SRC

** Science
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun science-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.sciencemag.org" *doi-utils-redirect*)
    (concat *doi-utils-redirect* ".full.pdf")))
#+END_SRC

** Nature
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun nature-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.nature.com" *doi-utils-redirect*)
    (let ((result *doi-utils-redirect*))
      (setq result (replace-regexp-in-string "/full/" "/pdf/" result))
      (replace-regexp-in-string "\.html$" "\.pdf" result))))
#+END_SRC

** Wiley
http://onlinelibrary.wiley.com/doi/10.1002/anie.201402680/abstract
http://onlinelibrary.wiley.com/doi/10.1002/anie.201402680/pdf

It appears that it is not enough to use the pdf url above. That takes you to an html page. The actual link to teh pdf is embedded in that page. This is how ScienceDirect does things too.

This is where the link is hidden:

<iframe id="pdfDocument" src="http://onlinelibrary.wiley.com/store/10.1002/anie.201402680/asset/6397_ftp.pdf?v=1&amp;t=hwut2142&amp;s=d4bb3cd4ad20eb733836717f42346ffb34017831" width="100%" height="675px"></iframe>



#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun doi-utils-get-wiley-pdf-url (redirect-url)
  "wileyscience direct hides the pdf url in html. we get it out here"
  (setq *doi-utils-waiting* t)
  (url-retrieve redirect-url
		(lambda (status)
		  (beginning-of-buffer)
		  (re-search-forward "<iframe id=\"pdfDocument\" src=\"\\([^\"]*\\)\"" nil)
		  (setq *doi-utils-pdf-url* (match-string 1)
			,*doi-utils-waiting* nil)))
  (while *doi-utils-waiting* (sleep-for 0.1))
  ,*doi-utils-pdf-url*)

(defun wiley-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://onlinelibrary.wiley.com" *doi-utils-redirect*)
   (doi-utils-get-wiley-pdf-url (replace-regexp-in-string "/abstract" "/pdf" *doi-utils-redirect*))
   ,*doi-utils-pdf-url*))
#+END_SRC

** Springer
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun springer-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://link.springer.com" *doi-utils-redirect*)
    (replace-regexp-in-string "/article/" "/content/pdf/" (concat *doi-utils-redirect* ".pdf"))))
#+END_SRC

** ACS
here is a typical url http://pubs.acs.org/doi/abs/10.1021/nl500037x
the pdf is found at http://pubs.acs.org/doi/pdf/10.1021/nl500037x

we just change /abs/ to /pdf/.

#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun acs-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://pubs.acs.org" *doi-utils-redirect*)
    (replace-regexp-in-string "/abs/" "/pdf/" *doi-utils-redirect*)))
#+END_SRC

#+BEGIN_SRC emacs-lisp :tangle no
(acs-pdf-url  "http://pubs.acs.org/doi/abs/10.1021/nl500037x")
#+END_SRC

#+RESULTS:
: http://pubs.acs.org/doi/pdf/10.1021/nl500037x

** IOP
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun iop-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://iopscience.iop.org" *doi-utils-redirect*)
    (let ((tail (replace-regexp-in-string "^http://iopscience.iop.org" "" *doi-utils-redirect*)))
      (concat "http://iopscience.iop.org" tail "/pdf" (replace-regexp-in-string "/" "_" tail) ".pdf"))))
#+END_SRC

** JSTOR
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun jstor-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.jstor.org" *doi-utils-redirect*)
    (concat (replace-regexp-in-string "/stable/" "/stable/pdfplus/" *doi-utils-redirect*) ".pdf")))
#+END_SRC

** AIP
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun aip-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://scitation.aip.org" *doi-utils-redirect*)
    ;; get stuff after content
    (let (p1 p2 s p3)
      (setq p2 (replace-regexp-in-string "^http://scitation.aip.org/" "" *doi-utils-redirect*))
      (setq s (split-string p2 "/"))
      (setq p1 (mapconcat 'identity (-remove-at-indices '(0 6) s) "/"))
      (setq p3 (concat "/" (nth 0 s) (nth 1 s) "/" (nth 2 s) "/" (nth 3 s)))
      (format "http://scitation.aip.org/deliver/fulltext/%s.pdf?itemId=/%s&mimeType=pdf&containerItemId=%s"
	      p1 p2 p3))))
#+END_SRC

** Taylor and Francis
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun tandfonline-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.tandfonline.com" *doi-utils-redirect*)
    (replace-regexp-in-string "/abs/\\|/full/" "/pdf/" *doi-utils-redirect*)))
#+END_SRC
** ECS
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun ecs-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://jes.ecsdl.org" *doi-utils-redirect*)
    (replace-regexp-in-string "\.abstract$" ".full.pdf" *doi-utils-redirect*)))
#+END_SRC

http://ecst.ecsdl.org/content/25/2/2769
http://ecst.ecsdl.org/content/25/2/2769.full.pdf

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun ecst-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://ecst.ecsdl.org" *doi-utils-redirect*)
    (concat *doi-utils-redirect* ".full.pdf")))
#+END_SRC


** RSC
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun rsc-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://pubs.rsc.org" *doi-utils-redirect*)
    (let ((url (downcase *doi-utils-redirect*)))
      (setq url (replace-regexp-in-string "articlelanding" "articlepdf" url))
      url)))
#+END_SRC

** Elsevier/ScienceDirect
You cannot compute these pdf links; they are embedded in the redirected pages.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defvar *doi-utils-pdf-url* nil
  "stores url to pdf download from a callback function")

(defun doi-utils-get-science-direct-pdf-url (redirect-url)
  "science direct hides the pdf url in html. we get it out here"
  (setq *doi-utils-waiting* t)
  (url-retrieve redirect-url
		(lambda (status)
		  (beginning-of-buffer)
		  (re-search-forward "pdfurl=\"\\([^\"]*\\)\"" nil t)
		  (setq *doi-utils-pdf-url* (match-string 1)
			,*doi-utils-waiting* nil)))
  (while *doi-utils-waiting* (sleep-for 0.1))
  ,*doi-utils-pdf-url*)


(defun science-direct-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.sciencedirect.com" *doi-utils-redirect*)
    (doi-utils-get-science-direct-pdf-url *doi-utils-redirect*)
    ,*doi-utils-pdf-url*))

;; sometimes I get
;; http://linkinghub.elsevier.com/retrieve/pii/S0927025609004558
;; which actually redirect to
;; http://www.sciencedirect.com/science/article/pii/S0927025609004558
(defun linkinghub-elsevier-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://linkinghub.elsevier.com/retrieve" *doi-utils-redirect*)
    (let ((second-redirect (replace-regexp-in-string
			    "http://linkinghub.elsevier.com/retrieve"
			    "http://www.sciencedirect.com/science/article"
			    ,*doi-utils-redirect*)))
      (message "getting pdf url from %s" second-redirect)
      ;(doi-utils-get-science-direct-pdf-url second-redirect)
      ,*doi-utils-pdf-url*)))
#+END_SRC

** PNAS
http://www.pnas.org/content/early/2014/05/08/1319030111
http://www.pnas.org/content/early/2014/05/08/1319030111.full.pdf

with supporting info
http://www.pnas.org/content/early/2014/05/08/1319030111.full.pdf+html?with-ds=yes
#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun pnas-pdf-url (*doi-utils-redirect*)
  (when (string-match "^http://www.pnas.org" *doi-utils-redirect*)
    (concat *doi-utils-redirect* ".full.pdf?with-ds=yes")))
#+END_SRC

** Add all functions
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(setq doi-utils-pdf-url-functions
      (list
       'aps-pdf-url
       'science-pdf-url
       'nature-pdf-url
       'wiley-pdf-url
       'springer-pdf-url
       'acs-pdf-url
       'iop-pdf-url
       'jstor-pdf-url
       'aip-pdf-url
       'science-direct-pdf-url
       'linkinghub-elsevier-pdf-url
       'tandfonline-pdf-url
       'ecs-pdf-url
       'ecst-pdf-url
       'rsc-pdf-url
       'pnas-pdf-url))
#+END_SRC

** Get the pdf url for a doi
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-get-pdf-url (doi)
  "returns a url to a pdf for the doi if one can be
calculated. Loops through the functions in `doi-utils-pdf-url-functions'
until one is found"
  (doi-utils-get-redirect doi)

  (unless *doi-utils-redirect*
    (error "No redirect found for %s" doi))
  (message "applying functions")
  (catch 'pdf-url
    (dolist (func doi-utils-pdf-url-functions)
     (message "calling %s" func)
      (let ((this-pdf-url (funcall func *doi-utils-redirect*)))
(message "t: %s" this-pdf-url)
	(when this-pdf-url
          (message "found pdf url: %s" this-pdf-url)
	  (throw 'pdf-url this-pdf-url))))))
#+END_SRC

#+RESULTS:
: doi-utils-get-pdf-url


#+BEGIN_SRC emacs-lisp :tangle no
(doi-utils-get-pdf-url "10.1126/science.1158722")
#+END_SRC

#+RESULTS:
: http://www.sciencemag.org/content/321/5890/792.full.pdf

#+BEGIN_SRC emacs-lisp :tangle no
(doi-utils-get-pdf-url  "10.1021/nl500037x")
#+END_SRC

#+RESULTS:
: http://pubs.acs.org/doi/pdf/10.1021/nl500037x


#+BEGIN_SRC emacs-lisp :tangle no
(doi-utils-get-pdf-url  "10.1002/anie.201402680")
#+END_SRC

#+RESULTS:
: http://onlinelibrary.wiley.com/doi/10.1002/anie.201402680/pdf

** Finally, download the pdf
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-get-bibtex-entry-pdf ()
  "download pdf for entry at point if the pdf does not already
exist locally. The entry must have a doi. The pdf will be saved
to `org-ref-pdf-directory', by the name %s.pdf where %s is the
bibtex label. Files will not be overwritten. The pdf will be
checked to make sure it is a pdf, and not some html failure
page. you must have permission to access the pdf. We open the pdf
at the end."
  (interactive)
  (save-excursion
    (bibtex-beginning-of-entry)
    (let (;; get doi, removing http://dx.doi.org/ if it is there.
	  (doi (replace-regexp-in-string
		"http://dx.doi.org/" ""
		(bibtex-autokey-get-field "doi")))
	  (key)
	  (pdf-url)
	  (pdf-file)
	  (content))
      ;; get the key and build pdf filename.
      (re-search-forward bibtex-entry-maybe-empty-head)
      (setq key (match-string bibtex-key-in-head))
      (setq pdf-file (concat org-ref-pdf-directory key ".pdf"))

      ;; now get file if needed.
      (when (and doi (not (file-exists-p pdf-file)))
	(setq pdf-url (doi-utils-get-pdf-url doi))
	(if pdf-url
	    (progn
	      (url-copy-file pdf-url pdf-file)
	      ;; now check if we got a pdf
	      (with-temp-buffer
		(insert-file-contents pdf-file)
		;; PDFS start with %PDF-1.x as the first few characters.
		(if (not (string= (buffer-substring 1 6) "%PDF-"))
		    (progn
		      (message "%s" (buffer-string))
		      (delete-file pdf-file))
		  (message "%s saved" pdf-file)))

	      (when (file-exists-p pdf-file)
		(org-open-file pdf-file)))
	  (message "No pdf-url found for %s at %s" doi *doi-utils-redirect* ))
	  pdf-file))))
#+END_SRC

* Getting bibtex entries from a DOI

I [[http://homepages.see.leeds.ac.uk/~eeaol/notes/2013/02/doi-metadata/][found]] you can download metadata about a DOI from http://dx.doi.org. You just have to construct the right http request to get it. Here is a function that gets the metadata as a plist in emacs.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-get-json-metadata (doi)
  "Try to get json metadata for DOI. Open the DOI in a browser if we do not get it."
  (let ((url-request-method "GET")
	(url-mime-accept-string "application/citeproc+json")
	(json-object-type 'plist)
	(json-data))
    (with-current-buffer
	(url-retrieve-synchronously
	 (concat "http://dx.doi.org/" doi))
      (setq json-data (buffer-substring url-http-end-of-headers (point-max)))
      (if (string-match "Resource not found" json-data)
	  (progn
	    (browse-url (concat "http://dx.doi.org/" doi))
	    (error "Resource not found. Opening website."))
	(json-read-from-string json-data)))))
#+END_SRC

#+RESULTS:
: doi-utils-get-json-metadata

For example:
#+BEGIN_SRC emacs-lisp :tangle no
(doi-utils-get-json-metadata "10.1103/PhysRevLett.99.016105")
#+END_SRC

#+RESULTS:
| :volume | 99 | :indexed | (:timestamp 1399964115538.0 :date-parts [[2014 5 13]]) | :publisher | American Physical Society (APS) | :source | CrossRef | :URL | http://dx.doi.org/10.1103/PhysRevLett.99.016105 | :ISSN | [0031-9007 1079-7114] | :DOI | 10.1103/physrevlett.99.016105 | :type | journal-article | :title | Scaling Properties of Adsorption Energies for Hydrogen-Containing Molecules on Transition-Metal Surfaces | :issue | 1 | :deposited | (:timestamp 1313712000000.0 :date-parts [[2011 8 19]]) | :reference-count | 26 | :container-title | Phys. Rev. Lett. | :author | [(:given F. :family Abild-Pedersen) (:given J. :family Greeley) (:given F. :family Studt) (:given J. :family Rossmeisl) (:given T. :family Munter) (:given P. :family Moses) (:given E. :family Skúlason) (:given T. :family Bligaard) (:given J. :family Nørskov)] | :prefix | http://id.crossref.org/prefix/10.1103 | :score | 1.0 | :issued | (:date-parts [[2007 7]]) | :subject | [Physics and Astronomy(all)] | :subtitle | [] |

We can use that data to construct a bibtex entry. We do that by defining a template, and filling it in. I wrote this template expansion code which makes it easy to substitute values like %{} in emacs lisp.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-expand-template (s)
  "expand a template containing %{} with the eval of its contents"
  (replace-regexp-in-string "%{\\([^}]+\\)}"
                            (lambda (arg)
                              (let ((sexp (substring arg 2 -1)))
                                (format "%s" (eval (read sexp))))) s))
#+END_SRC

Now we define a function that fills in that template from the metadata.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-doi-to-bibtex-string (doi)
  "return a bibtex entry as a string for the doi. Only articles are currently supported"
  (let (type
	results
	author
	title
	booktitle
	journal
	year
	volume
	number
	pages
	month
	url
	json-data)
    (setq results (doi-utils-get-json-metadata doi)
	  json-data (format "%s" results)
	  type (plist-get results :type)
	  author (mapconcat (lambda (x) (concat (plist-get x :given) " " (plist-get x :family)))
			    (plist-get results :author) " and ")
	  title (plist-get results :title)
	  journal (plist-get results :container-title)
	  volume (plist-get results :volume)
	  issue (plist-get results :issue)
	  year (elt (elt (plist-get (plist-get results :issued) :date-parts) 0) 0)
	  pages (plist-get results :page)
	  doi (plist-get results :DOI)
	  url (plist-get results :URL))
    (cond
     ((or (string= type "journal-article") (string= type "article-journal"))
      (doi-utils-expand-template "@article{,
  author =	 {%{author}},
  title =	 {%{title}},
  journal =	 {%{journal}},
  year =	 {%{year}},
  volume =	 {%{volume}},
  number =	 {%{issue}},
  pages =	 {%{pages}},
  doi =          {%{doi}},
  url =          {%{url}},
}"))

     ((string= type "proceedings-article")
      (setq booktitle (plist-get results :container-title))
      (doi-utils-expand-template "@inproceedings{,
  author =	 {%{author}},
  title =	 {%{title}},
  booktitle =    {%{booktitle}},
  year =	 {%{year}},
  month =	 {%{month}},
  pages =	 {%{pages}},
  doi =          {%{doi}},
  url =          {%{url}},
}"))

    (t (message-box "%s not supported yet." type)))))
#+END_SRC

#+RESULTS:
: doi-utils-doi-to-bibtex-string

To see that in action:
#+BEGIN_SRC emacs-lisp :tangle no
(doi-utils-doi-to-bibtex-string "10.1103/PhysRevLett.99.016105")
#+END_SRC

#+RESULTS:
#+begin_example
@article{,
  author =	 {F. Abild-Pedersen and J. Greeley and F. Studt and J. Rossmeisl and T. Munter and P. Moses and E. Skúlason and T. Bligaard and J. Nørskov},
  title =	 {Scaling Properties of Adsorption Energies for Hydrogen-Containing Molecules on Transition-Metal Surfaces},
  journal =	 {Phys. Rev. Lett.},
  year =	 {2007},
  volume =	 {99},
  number =	 {1},
  pages =	 {nil},
  doi =          {10.1103/physrevlett.99.016105},
  url =          {http://dx.doi.org/10.1103/PhysRevLett.99.016105},
}
#+end_example

That is just the string for the entry. To be useful, we need a function that inserts the string into a buffer. This function will insert the string at the cursor, clean the entry, try to get the pdf, and create a notes entry for you.

#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun doi-utils-insert-bibtex-entry-from-doi (doi)
  "insert bibtex entry from a doi. Also cleans entry using
org-ref, and tries to download the corresponding pdf."
  (interactive "sDOI :")
  (insert (doi-utils-doi-to-bibtex-string doi))
  (backward-char)
  (if (bibtex-key-in-head nil)
       (org-ref-clean-bibtex-entry t)
     (org-ref-clean-bibtex-entry))
   ;; try to get pdf
   (doi-utils-get-bibtex-entry-pdf)
   (save-selected-window
     (org-ref-open-bibtex-notes)))
#+END_SRC

It may be you are in some other place when you want to add a bibtex entry. This next function will open the first entry in org-ref-default-bibliography go to the end, and add the entry. You can sort it later.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-add-bibtex-entry-from-doi (doi bibfile)
  "Add entry to end of a file in in the current directory ending
with .bib or in `org-ref-default-bibliography'. If you have an
active region that starts like a DOI, that will be the initial
prompt. If no region is selected and the first entry of the
kill-ring starts like a DOI, then that is the intial
prompt. Otherwise, you have to type or pste in a DOI."
  (interactive
   (list (read-input "DOI: "
		     ;; now set initial input
		     (cond
		      ;; If region is active and it starts like a doi we want it.
		      ((and  (region-active-p)
                             (s-match "^10" (buffer-substring
					      (region-beginning)
					      (region-end))))
		       (buffer-substring (region-beginning) (region-end)))
		      ;; if the first entry in the kill-ring looks
		      ;; like a DOI, let's use it.
		      ((if (s-match "^10" (car kill-ring))
			   (car kill-ring)))
		      ;; otherwise, we have no initial input. You
		      ;; will have to type it in.
		      (t
		       nil)))
	 ;;  now get the bibfile to add it to
	 (ido-completing-read
	  "Bibfile: "
	  (append (f-entries "." (lambda (f) (f-ext? f "bib")))
		  org-ref-default-bibliography))))
  ;; Wrap in save-window-excursion to restore your window arrangement after this
  ;; is done.
  (save-window-excursion
    (find-file bibfile)
    ;; Check if the doi already exists
    (goto-char (point-min))
    (if (search-forward doi nil t)
	(message "%s is already in this file" doi)
      (end-of-buffer)
      (insert "\n\n")
      (doi-utils-insert-bibtex-entry-from-doi doi)
      (save-buffer))))
#+END_SRC


* Updating bibtex entries
I wrote this code because it is pretty common for me to copy bibtex entries from ASAP articles that are incomplete, e.g. no page numbers because it is not in print yet. I wanted a convenient way to update an entry from its DOI. Basically, we get the metadata, and update the fields in the entry.

There is not bibtex set field function, so I wrote this one.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun bibtex-set-field (field value &optional nodelim)
  "set field to value in bibtex file. create field if it does not exist"
  (interactive "sfield: \nsvalue: ")
  (bibtex-beginning-of-entry)
  (let ((found))
    (if (setq found (bibtex-search-forward-field field t))
	;; we found a field
	(progn
	  (goto-char (car (cdr found)))
	  (when value
	    (bibtex-kill-field)
	    (bibtex-make-field field nil nil nodelim)
	    (backward-char)
	    (insert value)))
      ;; make a new field
      (message "new field being made")
      (bibtex-beginning-of-entry)
      (forward-line) (beginning-of-line)
      (bibtex-next-field nil)
      (forward-char)
      (bibtex-make-field field nil nil nodelim)
      (backward-char)
      (insert value))))
#+END_SRC

The updating function looks like this. We get all the keys from the json plist metadata, and update the fields if they exist.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun plist-get-keys (plist)
   "return keys in a plist"
  (loop
   for key in results by #'cddr collect key))

(defun doi-utils-update-bibtex-entry-from-doi (doi)
  "update fields in a bibtex entry from the doi. Every field will be updated, so previous changes will be lost."
  (interactive (list
		(or (replace-regexp-in-string "http://dx.doi.org/" "" (bibtex-autokey-get-field "doi"))
		    (read-string "DOI: "))))
  (let* ((results (doi-utils-get-json-metadata doi))
	 (type (plist-get results :type))
	 (author (mapconcat
		  (lambda (x) (concat (plist-get x :given)
				    " " (plist-get x :family)))
		  (plist-get results :author) " and "))
	 (title (plist-get results :title))
	 (journal (plist-get results :container-title))
	 (year (format "%s"
		       (elt
			(elt
			 (plist-get
			  (plist-get results :issued) :date-parts) 0) 0)))
	(volume (plist-get results :volume))
	(number (or (plist-get results :issue) ""))
	(pages (or (plist-get results :page) ""))
	(url (or (plist-get results :URL) ""))
	(doi (plist-get results :DOI)))

    ;; map the json fields to bibtex fields. The code each field is mapped to is evaluated.
    (setq mapping '((:author . (bibtex-set-field "author" author))
		    (:title . (bibtex-set-field "title" title))
		    (:container-title . (bibtex-set-field "journal" journal))
		    (:issued . (bibtex-set-field "year" year))
		    (:volume . (bibtex-set-field "volume" volume))
		    (:issue . (bibtex-set-field "number" number))
		    (:page . (bibtex-set-field "pages" pages))
		    (:DOI . (bibtex-set-field "doi" doi))
		    (:URL . (bibtex-set-field "url" url))))

    ;; now we have code to run for each entry. we map over them and evaluate the code
    (mapcar
     (lambda (key)
       (eval (cdr (assoc key mapping))))
     (plist-get-keys results)))

  ; reclean entry, but keep key if it exists.
  (if (bibtex-key-in-head)
      (org-ref-clean-bibtex-entry t)
    (org-ref-clean-bibtex-entry)))
#+END_SRC
* DOI functions for WOS
I came across this API http://wokinfo.com/media/pdf/OpenURL-guide.pdf to make links to the things I am interested in here. Based on that document, here are three links based on a doi:10.1021/jp047349j that take you to different Web Of Science (WOS) pages.


1. go to article in WOS: http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info:doi/10.1021/jp047349j
2. citing articles: http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info%3Adoi%2F10.1021/jp047349j&svc_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Asch_svc&svc.citing=yes
3. related articles: http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info%3Adoi%2F10.1021/jp047349j&svc_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Asch_svc&svc.related=yes

These are pretty easy to construct, so we can write functions that will create them and open the url in our browser. There are some other options that could be considered, but since we usually have a doi, it seems like the best way to go for creating the links. Here are the functions.

#+BEGIN_SRC emacs-lisp  :tangle doi-utils.el
(defun doi-utils-wos (doi)
  "Open Web of Science entry for DOI"
  (interactive "sDOI: ")
  (browse-url
   (format
    "http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info:doi/%s" doi)))

(defun doi-utils-wos-citing (doi)
  "Open Web of Science citing articles entry. May be empty if none are found"
  (interactive "sDOI: ")
  (browse-url
   (concat
    "http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info%3Adoi%2F"
    doi
    "&svc_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Asch_svc&svc.citing=yes")))

(defun doi-utils-wos-related (doi)
  "Open Web of Science related articles page."
  (interactive "sDOI: ")
  (browse-url
   (concat "http://ws.isiknowledge.com/cps/openurl/service?url_ver=Z39.88-2004&rft_id=info%3Adoi%2F"
	   doi
	   "&svc_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Asch_svc&svc.related=yes")))

#+END_SRC

* A new doi link for org-mode
The idea is to add a menu to the doi link, so rather than just clicking to open the article, you can do other things.
1. open doi
2. open in wos
3. open citing articles
4. open related articles
5. open bibtex entry
6. get bibtex entry

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el :results silent
(defun doi-utils-open (doi)
 (interactive "sDOI: ")
 (browse-url (concat "http://dx.doi.org/" doi)))


(defun doi-utils-open-bibtex (doi)
  "Search through `reftex-default-bibliography' for DOI."
  (interactive "sDOI: ")
  (catch 'file
    (dolist (f reftex-default-bibliography)
      (find-file f)
      (when (search-forward doi (point-max) t)
	(bibtex-beginning-of-entry)
	(throw 'file t)))))


(defun doi-utils-crossref (doi)
  "Search DOI in CrossRef."
  (interactive "sDOI: ")
  (browse-url
   (format
    "http://search.crossref.org/?q=%s" doi)))


(defun doi-utils-google-scholar (doi)
  "Google scholar the word at point or selection."
  (interactive "sDOI: ")
  (browse-url
   (format
    "http://scholar.google.com/scholar?q=%s" doi)))


(defun doi-utils-pubmed (doi)
  "Pubmed the word at point or selection."
  (interactive "sDOI: ")
  (browse-url
   (format
    "http://www.ncbi.nlm.nih.gov/pubmed/?term=%s"
    (url-hexify-string doi))))


(defvar doi-link-menu-funcs '()
 "Functions to run in doi menu. Each entry is a list of (key menu-name function).
The function must take one argument, the doi.")

(setq doi-link-menu-funcs
      '(("o" "pen" doi-utils-open)
	("w" "os" doi-utils-wos)
	("c" "iting articles" doi-utils-wos-citing)
	("r" "elated articles" doi-utils-wos-related)
        ("s" "Google Scholar" doi-utils-google-scholar)
        ("f" "CrossRef" doi-utils-crossref)
        ("p" "ubmed" doi-utils-pubmed)
	("b" "open in bibtex" doi-utils-open-bibtex)
	("g" "et bibtex entry" doi-utils-add-bibtex-entry-from-doi)))


(defun doi-link-menu (link-string)
   "Generate the link menu message, get choice and execute it.
Options are stored in `doi-link-menu-funcs'."
   (interactive)
   (message
   (concat
    (mapconcat
     (lambda (tup)
       (concat "[" (elt tup 0) "]"
	       (elt tup 1) " "))
     doi-link-menu-funcs "") ": "))
   (let* ((input (read-char-exclusive))
	  (choice (assoc
		   (char-to-string input) doi-link-menu-funcs)))
     (when choice
       (funcall
	(elt
	 choice
	 2)
	link-string))))

(org-add-link-type
 "doi"
 'doi-link-menu)
#+END_SRC

doi:10.1021/jp047349j


* Getting a doi for a bibtex entry missing one
Some bibtex entries do not have a DOI, maybe because they were entered by hand, or copied from a source that did not have it available. Here we develop some functions to help you find the DOI using Crossref.

Here is our example bibtex entry.
#+BEGIN_SRC bibtex
@article{deml-2014-oxide,
  author =	 {Ann M. Deml and Vladan Stevanovi{\'c} and
                  Christopher L. Muhich and Charles B. Musgrave and
                  Ryan O'Hayre},
  title =	 {Oxide Enthalpy of Formation and Band Gap Energy As
                  Accurate Descriptors of Oxygen Vacancy Formation
                  Energetics},
  journal =	 {Energy Environ. Sci.},
  volume =	 7,
  number =	 6,
  pages =	 1996,
  year =	 2014,
  doi =		 {10.1039/c3ee43874k,
  url =		 {http://dx.doi.org/10.1039/c3ee43874k}},

}


#+END_SRC

The idea is to query Crossref in a way that is likely to give us a hit relevant to the entry.

According to http://search.crossref.org/help/api we can send a query with a free form citation that may give us something back. We do this to get a list of candidates, and run a helm command to get the doi.


#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-crossref-citation-query ()
  "Query Crossref with the title of the bibtex entry at point to
get a list of possible matches. This opens a helm buffer to
select an entry. The default action inserts a doi and url field
in the bibtex entry at point. The second action opens the doi
url. If there is already a doi field, the function raises an
error."
  (interactive)
  (bibtex-beginning-of-entry)
  (let* ((entry (bibtex-parse-entry))
	 (json-string)
	 (json-data)
	 (doi))
    (unless (string= ""(reftex-get-bib-field "doi" entry))
      (error "Entry already has a doi field"))

    (with-current-buffer
	(url-retrieve-synchronously
	 (concat
	  "http://search.crossref.org/dois?q="
	  (url-hexify-string (org-ref-bib-citation))))
      (setq json-string (buffer-substring url-http-end-of-headers (point-max)))
      (setq json-data (json-read-from-string json-string)))

    (let* ((name (format "Crossref hits for %s" (org-ref-bib-citation)))
	   (helm-candidates (mapcar (lambda (x)
				      (cons
				       (concat
					(cdr (assoc 'fullCitation x))
					" "
					(cdr (assoc 'doi x)))
				       (cdr (assoc 'doi x))))
				      json-data))
	   (source `((name . ,name)
		     (candidates . ,helm-candidates)
		     ;; just return the candidate
		     (action . (("Insert doi and url field" . (lambda (doi)
								(bibtex-make-field "doi")
								(backward-char)
								;; crossref returns doi url, but I prefer only a doi for the doi field
								(insert (replace-regexp-in-string "^http://dx.doi.org/" "" doi))
								(when (string= ""(reftex-get-bib-field "url" entry))
								  (bibtex-make-field "url")
								  (backward-char)
								  (insert doi))))
				("Open url" . (lambda (doi)
						(browse-url doi))))))))
      (helm :sources '(source)))))
#+END_SRC

#+RESULTS:
: doi-utils-crossref-citation-query



* Adding a bibtex entry from a crossref query
The idea here is to perform a query on Crossref, get a helm buffer of candidates, and select the entry(ies) you want to add to your bibtex file. You can select a region, e.g. a free form citation, or set of words, or you can type the query in by hand.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun doi-utils-add-entry-from-crossref-query (query bibtex-file)
  (interactive (list
		(read-input
		 "Query: "
		 ;; now set initial input
		 (cond
		  ;; If region is active assume we want it
		  ((region-active-p)
		   (buffer-substring (region-beginning) (region-end)))
		  ;; type or paste it in
		  (t
		   nil)))
		(ido-completing-read
		 "Bibfile: "
		 (append (f-entries "." (lambda (f) (f-ext? f "bib")))
			 org-ref-default-bibliography))))
  (let* ((json-string)
	 (json-data)
	 (doi))

    (with-current-buffer
	(url-retrieve-synchronously
	 (concat
	  "http://search.crossref.org/dois?q="
	  (url-hexify-string query)))
      (setq json-string (buffer-substring url-http-end-of-headers (point-max)))
      (setq json-data (json-read-from-string json-string)))

    (let* ((name (format "Crossref hits for %s" query))
	   (helm-candidates (mapcar (lambda (x)
				      (cons
				       (concat
					(cdr (assoc 'fullCitation x))
					" "
					(cdr (assoc 'doi x)))
				       (cdr (assoc 'doi x))))
				      json-data))
	   (source `((name . ,name)
		     (candidates . ,helm-candidates)
		     ;; just return the candidate
		     (action . (("Insert bibtex entry" . (lambda (doi)
							   (doi-utils-add-bibtex-entry-from-doi
							    (replace-regexp-in-string "^http://dx.doi.org/" "" doi) ,bibtex-file)))
				("Open url" . (lambda (doi)
						(browse-url doi))))))))
      (helm :sources '(source)))))
#+END_SRC

** json

#+name: json
#+BEGIN_EXAMPLE
[
  {
    "doi": "http://dx.doi.org/10.1039/c3ee43874k",
    "score": 4.7002907,
    "normalizedScore": 100,
    "title": "Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics",
    "fullCitation": "Ann M. Deml, Vladan Stevanović, Christopher L. Muhich, Charles B. Musgrave, Ryan O'Hayre, 2014, 'Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics', <i>Energy &amp; Environmental Science</i>, vol. 7, no. 6, p. 1996",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3ee43874k&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxide+enthalpy+of+formation+and+band+gap+energy+as+accurate+descriptors+of+oxygen+vacancy+formation+energetics&amp;rft.jtitle=Energy+%26+Environmental+Science&amp;rft.date=2014&amp;rft.volume=7&amp;rft.issue=6&amp;rft.spage=1996&amp;rft.aufirst=Ann+M.&amp;rft.aulast=Deml&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Ann+M.+Deml&amp;rft.au=+Vladan+Stevanovi%C4%87&amp;rft.au=+Christopher+L.+Muhich&amp;rft.au=+Charles+B.+Musgrave&amp;rft.au=+Ryan+O%27Hayre",
    "year": "2014"
  },
  {
    "doi": "http://dx.doi.org/10.1103/physrevb.86.085123",
    "score": 1.129964,
    "normalizedScore": 24,
    "title": "Composition-dependent oxygen vacancy formation in multicomponent wide-band-gap oxides",
    "fullCitation": "Altynbek Murat, Julia E. Medvedeva, 2012, 'Composition-dependent oxygen vacancy formation in multicomponent wide-band-gap oxides', <i>Physical Review B</i>, vol. 86, no. 8",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1103%2Fphysrevb.86.085123&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Composition-dependent+oxygen+vacancy+formation+in+multicomponent+wide-band-gap+oxides&amp;rft.jtitle=Physical+Review+B&amp;rft.date=2012&amp;rft.volume=86&amp;rft.issue=8&amp;rft.aufirst=Altynbek&amp;rft.aulast=Murat&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Altynbek+Murat&amp;rft.au=+Julia+E.+Medvedeva",
    "year": "2012"
  },
  {
    "doi": "http://dx.doi.org/10.1021/cm5033755",
    "score": 0.94063884,
    "normalizedScore": 20,
    "title": " Tunable Oxygen Vacancy Formation Energetics in the Complex Perovskite Oxide Sr  x  La  1– x  Mn  y  Al  1– y  O 3 ",
    "fullCitation": "Ann M. Deml, Vladan Stevanović, Aaron M. Holder, Michael Sanders, Ryan O’Hayre, Charles B. Musgrave, 2014, ' Tunable Oxygen Vacancy Formation Energetics in the Complex Perovskite Oxide Sr  x  La  1– x  Mn  y  Al  1– y  O 3 ', <i>Chemistry of Materials</i>, vol. 26, no. 22, pp. 6595-6602",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1021%2Fcm5033755&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=+Tunable+Oxygen+Vacancy+Formation+Energetics+in+the+Complex+Perovskite+Oxide+Sr++x++La++1%E2%80%93+x++Mn++y++Al++1%E2%80%93+y++O+3+&amp;rft.jtitle=Chemistry+of+Materials&amp;rft.date=2014&amp;rft.volume=26&amp;rft.issue=22&amp;rft.spage=6595&amp;rft.epage=6602&amp;rft.aufirst=Ann+M.&amp;rft.aulast=Deml&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Ann+M.+Deml&amp;rft.au=+Vladan+Stevanovi%C4%87&amp;rft.au=+Aaron+M.+Holder&amp;rft.au=+Michael+Sanders&amp;rft.au=+Ryan+O%E2%80%99Hayre&amp;rft.au=+Charles+B.+Musgrave",
    "year": "2014"
  },
  {
    "doi": "http://dx.doi.org/10.1103/physrevb.37.5905",
    "score": 0.8346345,
    "normalizedScore": 17,
    "title": "Oxygen-vacancy-formation enthalpy in YBa_{2}(Cu_{0.985}Fe_{0.015})_{3}O_{7-δ} oxide superconductor",
    "fullCitation": "Chuck Blue, Khaled Elgaid, Ivan Zitkovsky, P. Boolchand, Darl McDaniel, W. Joiner, Jean Oostens, Warren Huff, 1988, 'Oxygen-vacancy-formation enthalpy in YBa_{2}(Cu_{0.985}Fe_{0.015})_{3}O_{7-δ} oxide superconductor', <i>Physical Review B</i>, vol. 37, no. 10, pp. 5905-5908",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1103%2Fphysrevb.37.5905&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxygen-vacancy-formation+enthalpy+in+YBa_%7B2%7D%28Cu_%7B0.985%7DFe_%7B0.015%7D%29_%7B3%7DO_%7B7-%CE%B4%7D+oxide+superconductor&amp;rft.jtitle=Physical+Review+B&amp;rft.date=1988&amp;rft.volume=37&amp;rft.issue=10&amp;rft.spage=5905&amp;rft.epage=5908&amp;rft.aufirst=Chuck&amp;rft.aulast=Blue&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Chuck+Blue&amp;rft.au=+Khaled+Elgaid&amp;rft.au=+Ivan+Zitkovsky&amp;rft.au=+P.+Boolchand&amp;rft.au=+Darl+McDaniel&amp;rft.au=+W.+Joiner&amp;rft.au=+Jean+Oostens&amp;rft.au=+Warren+Huff",
    "year": "1988"
  },
  {
    "doi": "http://dx.doi.org/10.1063/1.1732384",
    "score": 0.7613335,
    "normalizedScore": 16,
    "title": "Enthalpy of Formation of Oxygen Vacancies in Barium Oxide",
    "fullCitation": "H. Holloway, 1962, 'Enthalpy of Formation of Oxygen Vacancies in Barium Oxide', <i>The Journal of Chemical Physics</i>, vol. 36, no. 11, p. 2820",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.1732384&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Enthalpy+of+Formation+of+Oxygen+Vacancies+in+Barium+Oxide&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=1962&amp;rft.volume=36&amp;rft.issue=11&amp;rft.spage=2820&amp;rft.aufirst=H.&amp;rft.aulast=Holloway&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=H.+Holloway",
    "year": "1962"
  },
  {
    "doi": "http://dx.doi.org/10.1002/crat.2170221219",
    "score": 0.73206276,
    "normalizedScore": 15,
    "title": "Vacancy formation enthalpy in AgZn alloys",
    "fullCitation": "St. Chabik, 1987, 'Vacancy formation enthalpy in AgZn alloys', <i>Crystal Research and Technology</i>, vol. 22, no. 12, pp. 1523-1527",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1002%2Fcrat.2170221219&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Vacancy+formation+enthalpy+in+AgZn+alloys&amp;rft.jtitle=Crystal+Research+and+Technology&amp;rft.date=1987&amp;rft.volume=22&amp;rft.issue=12&amp;rft.spage=1523&amp;rft.epage=1527&amp;rft.aufirst=St.&amp;rft.aulast=Chabik&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=St.+Chabik",
    "year": "1987"
  },
  {
    "doi": "http://dx.doi.org/10.1007/s10562-013-0985-7",
    "score": 0.692246,
    "normalizedScore": 14,
    "title": "Methane Oxidation by Lanthanum Oxide Doped with Cu, Zn, Mg, Fe, Nb, Ti, Zr, or Ta: The Connection Between the Activation Energy and the Energy of Oxygen-Vacancy Formation",
    "fullCitation": "Alan R. Derk, Bo Li, Sudhanshu Sharma, George M. Moore, Eric W. McFarland, Horia Metiu, 2013, 'Methane Oxidation by Lanthanum Oxide Doped with Cu, Zn, Mg, Fe, Nb, Ti, Zr, or Ta: The Connection Between the Activation Energy and the Energy of Oxygen-Vacancy Formation', <i>Catalysis Letters</i>, vol. 143, no. 5, pp. 406-410",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1007%2Fs10562-013-0985-7&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Methane+Oxidation+by+Lanthanum+Oxide+Doped+with+Cu%2C+Zn%2C+Mg%2C+Fe%2C+Nb%2C+Ti%2C+Zr%2C+or+Ta%3A+The+Connection+Between+the+Activation+Energy+and+the+Energy+of+Oxygen-Vacancy+Formation&amp;rft.jtitle=Catalysis+Letters&amp;rft.date=2013&amp;rft.volume=143&amp;rft.issue=5&amp;rft.spage=406&amp;rft.epage=410&amp;rft.aufirst=Alan+R.&amp;rft.aulast=Derk&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Alan+R.+Derk&amp;rft.au=+Bo+Li&amp;rft.au=+Sudhanshu+Sharma&amp;rft.au=+George+M.+Moore&amp;rft.au=+Eric+W.+McFarland&amp;rft.au=+Horia+Metiu",
    "year": "2013"
  },
  {
    "doi": "http://dx.doi.org/10.1039/c3cp55214d",
    "score": 0.6675249,
    "normalizedScore": 14,
    "title": "Oxygen vacancy formation and annihilation in lanthanum cerium oxide as a metal reactive oxide on 4H-silicon carbide",
    "fullCitation": "Way Foong Lim, Kuan Yew Cheong, 2014, 'Oxygen vacancy formation and annihilation in lanthanum cerium oxide as a metal reactive oxide on 4H-silicon carbide', <i>Physical Chemistry Chemical Physics</i>, vol. 16, no. 15, p. 7015",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3cp55214d&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxygen+vacancy+formation+and+annihilation+in+lanthanum+cerium+oxide+as+a+metal+reactive+oxide+on+4H-silicon+carbide&amp;rft.jtitle=Physical+Chemistry+Chemical+Physics&amp;rft.date=2014&amp;rft.volume=16&amp;rft.issue=15&amp;rft.spage=7015&amp;rft.aufirst=Way+Foong&amp;rft.aulast=Lim&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Way+Foong+Lim&amp;rft.au=+Kuan+Yew+Cheong",
    "year": "2014"
  },
  {
    "doi": "http://dx.doi.org/10.1021/cm052543j",
    "score": 0.6519111,
    "normalizedScore": 13,
    "title": "Energetics of Bulk and Nano-Akaganeite, β-FeOOH:  Enthalpy of Formation, Surface Enthalpy, and Enthalpy of Water Adsorption",
    "fullCitation": "Lena Mazeina, Suraj Deore, Alexandra Navrotsky, 2006, 'Energetics of Bulk and Nano-Akaganeite, β-FeOOH:  Enthalpy of Formation, Surface Enthalpy, and Enthalpy of Water Adsorption', <i>Chemistry of Materials</i>, vol. 18, no. 7, pp. 1830-1838",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1021%2Fcm052543j&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Energetics+of+Bulk+and+Nano-Akaganeite%2C+%CE%B2-FeOOH%3A%C2%A0+Enthalpy+of+Formation%2C+Surface+Enthalpy%2C+and+Enthalpy+of+Water+Adsorption&amp;rft.jtitle=Chemistry+of+Materials&amp;rft.date=2006&amp;rft.volume=18&amp;rft.issue=7&amp;rft.spage=1830&amp;rft.epage=1838&amp;rft.aufirst=Lena&amp;rft.aulast=Mazeina&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Lena+Mazeina&amp;rft.au=+Suraj+Deore&amp;rft.au=+Alexandra+Navrotsky",
    "year": "2006"
  },
  {
    "doi": "http://dx.doi.org/10.1063/1.1677897",
    "score": 0.6344446,
    "normalizedScore": 13,
    "title": "Thermochemical and Theoretical Investigations of the Sodium-Oxygen System. I. The Standard Enthalpy of Formation of Sodium Oxide (Na2O)",
    "fullCitation": "P. A. G. O'Hare, 1972, 'Thermochemical and Theoretical Investigations of the Sodium-Oxygen System. I. The Standard Enthalpy of Formation of Sodium Oxide (Na2O)', <i>The Journal of Chemical Physics</i>, vol. 56, no. 9, p. 4513",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.1677897&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Thermochemical+and+Theoretical+Investigations+of+the+Sodium-Oxygen+System.+I.+The+Standard+Enthalpy+of+Formation+of+Sodium+Oxide+%28Na2O%29&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=1972&amp;rft.volume=56&amp;rft.issue=9&amp;rft.spage=4513&amp;rft.aufirst=P.+A.+G.&amp;rft.aulast=O%27Hare&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=P.+A.+G.+O%27Hare",
    "year": "1972"
  },
  {
    "doi": "http://dx.doi.org/10.1063/1.1679492",
    "score": 0.6344446,
    "normalizedScore": 13,
    "title": "Erratum: Thermochemical and theoretical investigations of the sodium-oxygen system. I. The standard enthalpy of formation of sodium oxide (Na2O)",
    "fullCitation": "P. A. G. O'Hare, 1973, 'Erratum: Thermochemical and theoretical investigations of the sodium-oxygen system. I. The standard enthalpy of formation of sodium oxide (Na2O)', <i>The Journal of Chemical Physics</i>, vol. 58, no. 5, p. 2196",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.1679492&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Erratum%3A+Thermochemical+and+theoretical+investigations+of+the+sodium-oxygen+system.+I.+The+standard+enthalpy+of+formation+of+sodium+oxide+%28Na2O%29&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=1973&amp;rft.volume=58&amp;rft.issue=5&amp;rft.spage=2196&amp;rft.aufirst=P.+A.+G.&amp;rft.aulast=O%27Hare&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=P.+A.+G.+O%27Hare",
    "year": "1973"
  },
  {
    "doi": "http://dx.doi.org/10.1002/pssb.19680250249",
    "score": 0.62748235,
    "normalizedScore": 13,
    "title": "On enthalpy calculation of vacancy formation in inorganic substances",
    "fullCitation": "B. N. Oshcherin, 1968, 'On enthalpy calculation of vacancy formation in inorganic substances', <i>Physica Status Solidi (b)</i>, vol. 25, no. 2, pp. K123-K125",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1002%2Fpssb.19680250249&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=On+enthalpy+calculation+of+vacancy+formation+in+inorganic+substances&amp;rft.jtitle=Physica+Status+Solidi+%28b%29&amp;rft.date=1968&amp;rft.volume=25&amp;rft.issue=2&amp;rft.spage=K123&amp;rft.epage=K125&amp;rft.aufirst=B.+N.&amp;rft.aulast=Oshcherin&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=B.+N.+Oshcherin",
    "year": "1968"
  },
  {
    "doi": "http://dx.doi.org/10.1002/pssb.2221040224",
    "score": 0.62748235,
    "normalizedScore": 13,
    "title": "Vacancy Formation Enthalpy in Cadmium by Positron Lifetime Measurements",
    "fullCitation": "P. Mascher, L. Breitenhuber, W. Puff, 1981, 'Vacancy Formation Enthalpy in Cadmium by Positron Lifetime Measurements', <i>physica status solidi (b)</i>, vol. 104, no. 2, pp. 601-605",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1002%2Fpssb.2221040224&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Vacancy+Formation+Enthalpy+in+Cadmium+by+Positron+Lifetime+Measurements&amp;rft.jtitle=physica+status+solidi+%28b%29&amp;rft.date=1981&amp;rft.volume=104&amp;rft.issue=2&amp;rft.spage=601&amp;rft.epage=605&amp;rft.aufirst=P.&amp;rft.aulast=Mascher&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=P.+Mascher&amp;rft.au=+L.+Breitenhuber&amp;rft.au=+W.+Puff",
    "year": "1981"
  },
  {
    "doi": "http://dx.doi.org/10.1016/0375-9601(79)90707-2",
    "score": 0.62748235,
    "normalizedScore": 13,
    "title": "Vacancy formation enthalpy in γ cerium from positron annihilation",
    "fullCitation": "M. Boidron, R. Paulin, 1979, 'Vacancy formation enthalpy in γ cerium from positron annihilation', <i>Physics Letters A</i>, vol. 73, no. 3, pp. 200-202",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1016%2F0375-9601%2879%2990707-2&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Vacancy+formation+enthalpy+in+%CE%B3+cerium+from+positron+annihilation&amp;rft.jtitle=Physics+Letters+A&amp;rft.date=1979&amp;rft.volume=73&amp;rft.issue=3&amp;rft.spage=200&amp;rft.epage=202&amp;rft.aufirst=M.&amp;rft.aulast=Boidron&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=M.+Boidron&amp;rft.au=+R.+Paulin",
    "year": "1979"
  },
  {
    "doi": "http://dx.doi.org/10.1016/0036-9748(83)90449-0",
    "score": 0.62748235,
    "normalizedScore": 13,
    "title": "Estimation of the vacancy formation enthalpy of metals",
    "fullCitation": "Alcides R. Patete, Joachim P. Neumann, 1983, 'Estimation of the vacancy formation enthalpy of metals', <i>Scripta Metallurgica</i>, vol. 17, no. 8, pp. 1047-1048",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1016%2F0036-9748%2883%2990449-0&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Estimation+of+the+vacancy+formation+enthalpy+of+metals&amp;rft.jtitle=Scripta+Metallurgica&amp;rft.date=1983&amp;rft.volume=17&amp;rft.issue=8&amp;rft.spage=1047&amp;rft.epage=1048&amp;rft.aufirst=Alcides+R.&amp;rft.aulast=Patete&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Alcides+R.+Patete&amp;rft.au=+Joachim+P.+Neumann",
    "year": "1983"
  },
  {
    "doi": "http://dx.doi.org/10.1039/c3ja50034a",
    "score": 0.62469214,
    "normalizedScore": 13,
    "title": "Formation of an oxygen vacancy-dinitrogen complex in nitrogen-doped hafnium oxide",
    "fullCitation": "Mino Yang, Jee-Hwan Bae, Cheol-Woong Yang, Anass Benayad, Hionsuck Baik, 2013, 'Formation of an oxygen vacancy-dinitrogen complex in nitrogen-doped hafnium oxide', <i>Journal of Analytical Atomic Spectrometry</i>, vol. 28, no. 4, p. 482",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3ja50034a&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Formation+of+an+oxygen+vacancy-dinitrogen+complex+in+nitrogen-doped+hafnium+oxide&amp;rft.jtitle=Journal+of+Analytical+Atomic+Spectrometry&amp;rft.date=2013&amp;rft.volume=28&amp;rft.issue=4&amp;rft.spage=482&amp;rft.aufirst=Mino&amp;rft.aulast=Yang&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Mino+Yang&amp;rft.au=+Jee-Hwan+Bae&amp;rft.au=+Cheol-Woong+Yang&amp;rft.au=+Anass+Benayad&amp;rft.au=+Hionsuck+Baik",
    "year": "2013"
  },
  {
    "doi": "http://dx.doi.org/10.1016/0021-9517(81)90023-3",
    "score": 0.62469214,
    "normalizedScore": 13,
    "title": "SCF-SW-X$alpha; calculations of the removal of oxygen from oxide surfaces by vacancy formation and crystallographic shear mechanisms",
    "fullCitation": "E BROCAWIK, 1981, 'SCF-SW-X$alpha; calculations of the removal of oxygen from oxide surfaces by vacancy formation and crystallographic shear mechanisms', <i>Journal of Catalysis</i>, vol. 72, no. 2, pp. 379-382",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1016%2F0021-9517%2881%2990023-3&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=SCF-SW-X%24alpha%3B+calculations+of+the+removal+of+oxygen+from+oxide+surfaces+by+vacancy+formation+and+crystallographic+shear+mechanisms&amp;rft.jtitle=Journal+of+Catalysis&amp;rft.date=1981&amp;rft.volume=72&amp;rft.issue=2&amp;rft.spage=379&amp;rft.epage=382&amp;rft.aufirst=E&amp;rft.aulast=BROCAWIK&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=E+BROCAWIK",
    "year": "1981"
  },
  {
    "doi": "http://dx.doi.org/10.1063/1.2335842",
    "score": 0.62469214,
    "normalizedScore": 13,
    "title": "Bulk and surface oxygen vacancy formation and diffusion in single crystals, ultrathin films, and metal grown oxide structures",
    "fullCitation": "J. Carrasco, N. Lopez, F. Illas, H.-J. Freund, 2006, 'Bulk and surface oxygen vacancy formation and diffusion in single crystals, ultrathin films, and metal grown oxide structures', <i>The Journal of Chemical Physics</i>, vol. 125, no. 7, p. 074711",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.2335842&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Bulk+and+surface+oxygen+vacancy+formation+and+diffusion+in+single+crystals%2C+ultrathin+films%2C+and+metal+grown+oxide+structures&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=2006&amp;rft.volume=125&amp;rft.issue=7&amp;rft.spage=074711&amp;rft.aufirst=J.&amp;rft.aulast=Carrasco&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=J.+Carrasco&amp;rft.au=+N.+Lopez&amp;rft.au=+F.+Illas&amp;rft.au=+H.-J.+Freund",
    "year": "2006"
  },
  {
    "doi": "http://dx.doi.org/10.1016/j.ijhydene.2011.12.079",
    "score": 0.6176822,
    "normalizedScore": 13,
    "title": "Oxygen vacancy formation on the Ni/Ce0.75Zr0.25O2(111) surface. A DFT+U study",
    "fullCitation": "Delfina García Pintos, Alfredo Juan, Beatriz Irigoyen, 2012, 'Oxygen vacancy formation on the Ni/Ce0.75Zr0.25O2(111) surface. A DFT+U study', <i>International Journal of Hydrogen Energy</i>, vol. 37, no. 19, pp. 14937-14944",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1016%2Fj.ijhydene.2011.12.079&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxygen+vacancy+formation+on+the+Ni%2FCe0.75Zr0.25O2%28111%29+surface.+A+DFT%2BU+study&amp;rft.jtitle=International+Journal+of+Hydrogen+Energy&amp;rft.date=2012&amp;rft.volume=37&amp;rft.issue=19&amp;rft.spage=14937&amp;rft.epage=14944&amp;rft.aufirst=Delfina&amp;rft.aulast=Garc%C3%ADa+Pintos&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Delfina+Garc%C3%ADa+Pintos&amp;rft.au=+Alfredo+Juan&amp;rft.au=+Beatriz+Irigoyen",
    "year": "2012"
  },
  {
    "doi": "http://dx.doi.org/10.1103/physrevb.90.144105",
    "score": 0.6172708,
    "normalizedScore": 13,
    "title": "Vacancy formation enthalpy of filled <span class=\"aps-inline-formula\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><mi>d</mi></math></span>-band noble metals by hybrid functionals",
    "fullCitation": "Weiwei Xing, Peitao Liu, Xiyue Cheng, Haiyang Niu, Hui Ma, Dianzhong Li, Yiyi Li, Xing-Qiu Chen, 2014, 'Vacancy formation enthalpy of filled &lt;span class=&quot;aps-inline-formula&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;&lt;/span&gt;-band noble metals by hybrid functionals', <i>Physical Review B</i>, vol. 90, no. 14",
    "coins": "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1103%2Fphysrevb.90.144105&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Vacancy+formation+enthalpy+of+filled+%3Cspan+class%3D%22aps-inline-formula%22%3E%3Cmath+xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1998%2FMath%2FMathML%22%3E%3Cmi%3Ed%3C%2Fmi%3E%3C%2Fmath%3E%3C%2Fspan%3E-band+noble+metals+by+hybrid+functionals&amp;rft.jtitle=Physical+Review+B&amp;rft.date=2014&amp;rft.volume=90&amp;rft.issue=14&amp;rft.aufirst=Weiwei&amp;rft.aulast=Xing&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Weiwei+Xing&amp;rft.au=+Peitao+Liu&amp;rft.au=+Xiyue+Cheng&amp;rft.au=+Haiyang+Niu&amp;rft.au=+Hui+Ma&amp;rft.au=+Dianzhong+Li&amp;rft.au=+Yiyi+Li&amp;rft.au=+Xing-Qiu+Chen",
    "year": "2014"
  }
]
#+END_EXAMPLE


#+BEGIN_SRC emacs-lisp :var data=json  :results value raw
(let ((json-object-type 'plist)
      (json (json-read-from-string data)))
(aref json 0))
#+END_SRC

#+RESULTS:
((year . 2014) (coins . ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3ee43874k&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxide+enthalpy+of+formation+and+band+gap+energy+as+accurate+descriptors+of+oxygen+vacancy+formation+energetics&amp;rft.jtitle=Energy+%26+Environmental+Science&amp;rft.date=2014&amp;rft.volume=7&amp;rft.issue=6&amp;rft.spage=1996&amp;rft.aufirst=Ann+M.&amp;rft.aulast=Deml&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Ann+M.+Deml&amp;rft.au=+Vladan+Stevanovi%C4%87&amp;rft.au=+Christopher+L.+Muhich&amp;rft.au=+Charles+B.+Musgrave&amp;rft.au=+Ryan+O%27Hayre) (fullCitation . Ann M. Deml, Vladan Stevanovi\304\207, Christopher L. Muhich, Charles B. Musgrave, Ryan O'Hayre, 2014, 'Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics', <i>Energy &amp; Environmental Science</i>, vol. 7, no. 6, p. 1996) (title . Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics) (normalizedScore . 100) (score . 4.7002907) (doi . http://dx.doi.org/10.1039/c3ee43874k))



Here is a list of helm candidates
#+BEGIN_SRC emacs-lisp :var data=json :results code
(let (;(json-object-type 'plist)
      (json (json-read-from-string data)))
  (mapcar (lambda (x) (cons (assoc 'fullCitation x) x)) json))
#+END_SRC

#+RESULTS:
#+BEGIN_SRC emacs-lisp
(((fullCitation . "Ann M. Deml, Vladan Stevanovi\304\207, Christopher L. Muhich, Charles B. Musgrave, Ryan O'Hayre, 2014, 'Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics', <i>Energy &amp; Environmental Science</i>, vol. 7, no. 6, p. 1996")
  (year . "2014")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3ee43874k&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxide+enthalpy+of+formation+and+band+gap+energy+as+accurate+descriptors+of+oxygen+vacancy+formation+energetics&amp;rft.jtitle=Energy+%26+Environmental+Science&amp;rft.date=2014&amp;rft.volume=7&amp;rft.issue=6&amp;rft.spage=1996&amp;rft.aufirst=Ann+M.&amp;rft.aulast=Deml&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Ann+M.+Deml&amp;rft.au=+Vladan+Stevanovi%C4%87&amp;rft.au=+Christopher+L.+Muhich&amp;rft.au=+Charles+B.+Musgrave&amp;rft.au=+Ryan+O%27Hayre")
  (fullCitation . "Ann M. Deml, Vladan Stevanovi\304\207, Christopher L. Muhich, Charles B. Musgrave, Ryan O'Hayre, 2014, 'Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics', <i>Energy &amp; Environmental Science</i>, vol. 7, no. 6, p. 1996")
  (title . "Oxide enthalpy of formation and band gap energy as accurate descriptors of oxygen vacancy formation energetics")
  (normalizedScore . 100)
  (score . 4.7002907)
  (doi . "http://dx.doi.org/10.1039/c3ee43874k"))
 ((fullCitation . "Altynbek Murat, Julia E. Medvedeva, 2012, 'Composition-dependent oxygen vacancy formation in multicomponent wide-band-gap oxides', <i>Physical Review B</i>, vol. 86, no. 8")
  (year . "2012")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1103%2Fphysrevb.86.085123&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Composition-dependent+oxygen+vacancy+formation+in+multicomponent+wide-band-gap+oxides&amp;rft.jtitle=Physical+Review+B&amp;rft.date=2012&amp;rft.volume=86&amp;rft.issue=8&amp;rft.aufirst=Altynbek&amp;rft.aulast=Murat&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Altynbek+Murat&amp;rft.au=+Julia+E.+Medvedeva")
  (fullCitation . "Altynbek Murat, Julia E. Medvedeva, 2012, 'Composition-dependent oxygen vacancy formation in multicomponent wide-band-gap oxides', <i>Physical Review B</i>, vol. 86, no. 8")
  (title . "Composition-dependent oxygen vacancy formation in multicomponent wide-band-gap oxides")
  (normalizedScore . 24)
  (score . 1.129964)
  (doi . "http://dx.doi.org/10.1103/physrevb.86.085123"))
 ((fullCitation . "Ann M. Deml, Vladan Stevanovi\304\207, Aaron M. Holder, Michael Sanders, Ryan O\342\200\231Hayre, Charles B. Musgrave, 2014, ' Tunable Oxygen Vacancy Formation Energetics in the Complex Perovskite Oxide Sr  x  La  1\342\200\223 x  Mn  y  Al  1\342\200\223 y  O 3 ', <i>Chemistry of Materials</i>, vol. 26, no. 22, pp. 6595-6602")
  (year . "2014")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1021%2Fcm5033755&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=+Tunable+Oxygen+Vacancy+Formation+Energetics+in+the+Complex+Perovskite+Oxide+Sr++x++La++1%E2%80%93+x++Mn++y++Al++1%E2%80%93+y++O+3+&amp;rft.jtitle=Chemistry+of+Materials&amp;rft.date=2014&amp;rft.volume=26&amp;rft.issue=22&amp;rft.spage=6595&amp;rft.epage=6602&amp;rft.aufirst=Ann+M.&amp;rft.aulast=Deml&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Ann+M.+Deml&amp;rft.au=+Vladan+Stevanovi%C4%87&amp;rft.au=+Aaron+M.+Holder&amp;rft.au=+Michael+Sanders&amp;rft.au=+Ryan+O%E2%80%99Hayre&amp;rft.au=+Charles+B.+Musgrave")
  (fullCitation . "Ann M. Deml, Vladan Stevanovi\304\207, Aaron M. Holder, Michael Sanders, Ryan O\342\200\231Hayre, Charles B. Musgrave, 2014, ' Tunable Oxygen Vacancy Formation Energetics in the Complex Perovskite Oxide Sr  x  La  1\342\200\223 x  Mn  y  Al  1\342\200\223 y  O 3 ', <i>Chemistry of Materials</i>, vol. 26, no. 22, pp. 6595-6602")
  (title . " Tunable Oxygen Vacancy Formation Energetics in the Complex Perovskite Oxide Sr  x  La  1\342\200\223 x  Mn  y  Al  1\342\200\223 y  O 3 ")
  (normalizedScore . 20)
  (score . 0.94063884)
  (doi . "http://dx.doi.org/10.1021/cm5033755"))
 ((fullCitation . "Chuck Blue, Khaled Elgaid, Ivan Zitkovsky, P. Boolchand, Darl McDaniel, W. Joiner, Jean Oostens, Warren Huff, 1988, 'Oxygen-vacancy-formation enthalpy in YBa_{2}(Cu_{0.985}Fe_{0.015})_{3}O_{7-\316\264} oxide superconductor', <i>Physical Review B</i>, vol. 37, no. 10, pp. 5905-5908")
  (year . "1988")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1103%2Fphysrevb.37.5905&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxygen-vacancy-formation+enthalpy+in+YBa_%7B2%7D%28Cu_%7B0.985%7DFe_%7B0.015%7D%29_%7B3%7DO_%7B7-%CE%B4%7D+oxide+superconductor&amp;rft.jtitle=Physical+Review+B&amp;rft.date=1988&amp;rft.volume=37&amp;rft.issue=10&amp;rft.spage=5905&amp;rft.epage=5908&amp;rft.aufirst=Chuck&amp;rft.aulast=Blue&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Chuck+Blue&amp;rft.au=+Khaled+Elgaid&amp;rft.au=+Ivan+Zitkovsky&amp;rft.au=+P.+Boolchand&amp;rft.au=+Darl+McDaniel&amp;rft.au=+W.+Joiner&amp;rft.au=+Jean+Oostens&amp;rft.au=+Warren+Huff")
  (fullCitation . "Chuck Blue, Khaled Elgaid, Ivan Zitkovsky, P. Boolchand, Darl McDaniel, W. Joiner, Jean Oostens, Warren Huff, 1988, 'Oxygen-vacancy-formation enthalpy in YBa_{2}(Cu_{0.985}Fe_{0.015})_{3}O_{7-\316\264} oxide superconductor', <i>Physical Review B</i>, vol. 37, no. 10, pp. 5905-5908")
  (title . "Oxygen-vacancy-formation enthalpy in YBa_{2}(Cu_{0.985}Fe_{0.015})_{3}O_{7-\316\264} oxide superconductor")
  (normalizedScore . 17)
  (score . 0.8346345)
  (doi . "http://dx.doi.org/10.1103/physrevb.37.5905"))
 ((fullCitation . "H. Holloway, 1962, 'Enthalpy of Formation of Oxygen Vacancies in Barium Oxide', <i>The Journal of Chemical Physics</i>, vol. 36, no. 11, p. 2820")
  (year . "1962")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.1732384&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Enthalpy+of+Formation+of+Oxygen+Vacancies+in+Barium+Oxide&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=1962&amp;rft.volume=36&amp;rft.issue=11&amp;rft.spage=2820&amp;rft.aufirst=H.&amp;rft.aulast=Holloway&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=H.+Holloway")
  (fullCitation . "H. Holloway, 1962, 'Enthalpy of Formation of Oxygen Vacancies in Barium Oxide', <i>The Journal of Chemical Physics</i>, vol. 36, no. 11, p. 2820")
  (title . "Enthalpy of Formation of Oxygen Vacancies in Barium Oxide")
  (normalizedScore . 16)
  (score . 0.7613335)
  (doi . "http://dx.doi.org/10.1063/1.1732384"))
 ((fullCitation . "St. Chabik, 1987, 'Vacancy formation enthalpy in AgZn alloys', <i>Crystal Research and Technology</i>, vol. 22, no. 12, pp. 1523-1527")
  (year . "1987")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1002%2Fcrat.2170221219&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Vacancy+formation+enthalpy+in+AgZn+alloys&amp;rft.jtitle=Crystal+Research+and+Technology&amp;rft.date=1987&amp;rft.volume=22&amp;rft.issue=12&amp;rft.spage=1523&amp;rft.epage=1527&amp;rft.aufirst=St.&amp;rft.aulast=Chabik&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=St.+Chabik")
  (fullCitation . "St. Chabik, 1987, 'Vacancy formation enthalpy in AgZn alloys', <i>Crystal Research and Technology</i>, vol. 22, no. 12, pp. 1523-1527")
  (title . "Vacancy formation enthalpy in AgZn alloys")
  (normalizedScore . 15)
  (score . 0.73206276)
  (doi . "http://dx.doi.org/10.1002/crat.2170221219"))
 ((fullCitation . "Alan R. Derk, Bo Li, Sudhanshu Sharma, George M. Moore, Eric W. McFarland, Horia Metiu, 2013, 'Methane Oxidation by Lanthanum Oxide Doped with Cu, Zn, Mg, Fe, Nb, Ti, Zr, or Ta: The Connection Between the Activation Energy and the Energy of Oxygen-Vacancy Formation', <i>Catalysis Letters</i>, vol. 143, no. 5, pp. 406-410")
  (year . "2013")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1007%2Fs10562-013-0985-7&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Methane+Oxidation+by+Lanthanum+Oxide+Doped+with+Cu%2C+Zn%2C+Mg%2C+Fe%2C+Nb%2C+Ti%2C+Zr%2C+or+Ta%3A+The+Connection+Between+the+Activation+Energy+and+the+Energy+of+Oxygen-Vacancy+Formation&amp;rft.jtitle=Catalysis+Letters&amp;rft.date=2013&amp;rft.volume=143&amp;rft.issue=5&amp;rft.spage=406&amp;rft.epage=410&amp;rft.aufirst=Alan+R.&amp;rft.aulast=Derk&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Alan+R.+Derk&amp;rft.au=+Bo+Li&amp;rft.au=+Sudhanshu+Sharma&amp;rft.au=+George+M.+Moore&amp;rft.au=+Eric+W.+McFarland&amp;rft.au=+Horia+Metiu")
  (fullCitation . "Alan R. Derk, Bo Li, Sudhanshu Sharma, George M. Moore, Eric W. McFarland, Horia Metiu, 2013, 'Methane Oxidation by Lanthanum Oxide Doped with Cu, Zn, Mg, Fe, Nb, Ti, Zr, or Ta: The Connection Between the Activation Energy and the Energy of Oxygen-Vacancy Formation', <i>Catalysis Letters</i>, vol. 143, no. 5, pp. 406-410")
  (title . "Methane Oxidation by Lanthanum Oxide Doped with Cu, Zn, Mg, Fe, Nb, Ti, Zr, or Ta: The Connection Between the Activation Energy and the Energy of Oxygen-Vacancy Formation")
  (normalizedScore . 14)
  (score . 0.692246)
  (doi . "http://dx.doi.org/10.1007/s10562-013-0985-7"))
 ((fullCitation . "Way Foong Lim, Kuan Yew Cheong, 2014, 'Oxygen vacancy formation and annihilation in lanthanum cerium oxide as a metal reactive oxide on 4H-silicon carbide', <i>Physical Chemistry Chemical Physics</i>, vol. 16, no. 15, p. 7015")
  (year . "2014")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2Fc3cp55214d&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Oxygen+vacancy+formation+and+annihilation+in+lanthanum+cerium+oxide+as+a+metal+reactive+oxide+on+4H-silicon+carbide&amp;rft.jtitle=Physical+Chemistry+Chemical+Physics&amp;rft.date=2014&amp;rft.volume=16&amp;rft.issue=15&amp;rft.spage=7015&amp;rft.aufirst=Way+Foong&amp;rft.aulast=Lim&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Way+Foong+Lim&amp;rft.au=+Kuan+Yew+Cheong")
  (fullCitation . "Way Foong Lim, Kuan Yew Cheong, 2014, 'Oxygen vacancy formation and annihilation in lanthanum cerium oxide as a metal reactive oxide on 4H-silicon carbide', <i>Physical Chemistry Chemical Physics</i>, vol. 16, no. 15, p. 7015")
  (title . "Oxygen vacancy formation and annihilation in lanthanum cerium oxide as a metal reactive oxide on 4H-silicon carbide")
  (normalizedScore . 14)
  (score . 0.6675249)
  (doi . "http://dx.doi.org/10.1039/c3cp55214d"))
 ((fullCitation . "Lena Mazeina, Suraj Deore, Alexandra Navrotsky, 2006, 'Energetics of Bulk and Nano-Akaganeite, \316\262-FeOOH:\302\240 Enthalpy of Formation, Surface Enthalpy, and Enthalpy of Water Adsorption', <i>Chemistry of Materials</i>, vol. 18, no. 7, pp. 1830-1838")
  (year . "2006")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1021%2Fcm052543j&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Energetics+of+Bulk+and+Nano-Akaganeite%2C+%CE%B2-FeOOH%3A%C2%A0+Enthalpy+of+Formation%2C+Surface+Enthalpy%2C+and+Enthalpy+of+Water+Adsorption&amp;rft.jtitle=Chemistry+of+Materials&amp;rft.date=2006&amp;rft.volume=18&amp;rft.issue=7&amp;rft.spage=1830&amp;rft.epage=1838&amp;rft.aufirst=Lena&amp;rft.aulast=Mazeina&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Lena+Mazeina&amp;rft.au=+Suraj+Deore&amp;rft.au=+Alexandra+Navrotsky")
  (fullCitation . "Lena Mazeina, Suraj Deore, Alexandra Navrotsky, 2006, 'Energetics of Bulk and Nano-Akaganeite, \316\262-FeOOH:\302\240 Enthalpy of Formation, Surface Enthalpy, and Enthalpy of Water Adsorption', <i>Chemistry of Materials</i>, vol. 18, no. 7, pp. 1830-1838")
  (title . "Energetics of Bulk and Nano-Akaganeite, \316\262-FeOOH:\302\240 Enthalpy of Formation, Surface Enthalpy, and Enthalpy of Water Adsorption")
  (normalizedScore . 13)
  (score . 0.6519111)
  (doi . "http://dx.doi.org/10.1021/cm052543j"))
 ((fullCitation . "P. A. G. O'Hare, 1972, 'Thermochemical and Theoretical Investigations of the Sodium-Oxygen System. I. The Standard Enthalpy of Formation of Sodium Oxide (Na2O)', <i>The Journal of Chemical Physics</i>, vol. 56, no. 9, p. 4513")
  (year . "1972")
  (coins . "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1063%2F1.1677897&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Thermochemical+and+Theoretical+Investigations+of+the+Sodium-Oxygen+System.+I.+The+Standard+Enthalpy+of+Formation+of+Sodium+Oxide+%28Na2O%29&amp;rft.jtitle=The+Journal+of+Chemical+Physics&amp;rft.date=1972&amp;rft.volume=56&amp;rft.issue=9&amp;rft.spage=4513&amp;rft.aufirst=P.+A.+G.&amp;rft.aulast=O%27Hare&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=P.+A.+G.+O%27Hare")
  (fullCitation . "P. A. G. O'Hare, 1972, 'Thermochemical and Theoretical Investigations of the Sodium-Oxygen System. I. The Standard Enthalpy of Formation of Sodium Oxide (Na2O)', <i>The Journal of Chemical Physics</i>, vol. 56, no. 9, p. 4513")
  (title . "Thermochemical and Theoretical Investigations of the Sodium-Oxygen System. I. The Standard Enthalpy of Formation of Sodium Oxide (Na2O)")
  (normalizedScore . 13)
  (score . 0.6344446)
  (doi . "http://dx.doi.org/10.1063/1.1677897"))
 ...)
#+END_SRC


* ISBN utility
These are not really doi utilities, but for now I am putting them here.

I found this on the web. It can be handy, but the bibtex entry has a lot of stuff in it.

#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun isbn-to-bibtex-lead (isbn)
 "Search lead.to for ISBN bibtex entry. You have to copy the entry if it is on the page to your bibtex file."
 (interactive "ISBN: ")
(browse-url
(format "http://lead.to/amazon/en/?key=%s+&si=all&op=bt&bn=&so=sa&ht=us" isbn)))
#+END_SRC

Here we get isbn metadata and build a bibtex entry.
http://xisbn.worldcat.org/xisbnadmin/doc/api.htm#getmetadata


#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(defun isbn-to-bibtex (isbn bibfile)
  "Get bibtex entry for ISBN and insert it into BIBFILE unless an
entry with the generated key already exists in the file."
  (interactive
   (list
    (read-input
     "ISBN: "
     ;; now set initial input
     (cond
      ;; If region is active and it starts with a number, we use it
      ((and  (region-active-p)
	     (s-match "^[0-9]" (buffer-substring (region-beginning) (region-end))))
       (buffer-substring (region-beginning) (region-end)))
      ;; if first entry in kill ring starts with a number assume it is an isbn
      ;; and use it as the guess
      ((if (s-match "^[0-9]" (car kill-ring))
	   (car kill-ring)))
      ;; type or paste it in
      (t
       nil)))
    (ido-completing-read
     "Bibfile: "
     (append (f-entries "." (lambda (f) (f-ext? f "bib")))
	     org-ref-default-bibliography))))

  (let* ((results (with-current-buffer
		      (url-retrieve-synchronously
		       (format
			"http://xisbn.worldcat.org/webservices/xid/isbn/%s?method=getMetadata&format=json&fl=*"
			isbn))
		    (json-read-from-string
		     (buffer-substring url-http-end-of-headers (point-max)))))
	 (status (cdr (nth 1 results)))
	 (metadata (aref (cdar results) 0))
	 (new-entry)
	 (new-key))

    ;; check if we got something
    (unless (string= "ok" status)
      (error "Status is %s" status))

    ;; construct an alphabetically sorted bibtex entry. I assume ISBN numbers go
    ;; with book entries.
    (setq new-entry
	  (concat "\n@book{,\n"
		  (mapconcat
		   'identity
		   (loop for field in (-sort 'string-lessp (mapcar 'car metadata))
			 collect
			 (format "  %s={%s}," field (cdr (assoc field metadata))))
		   "\n")
		  "\n}\n"))

    ;; build entry in temp buffer to get the key so we can check for duplicates
    (setq new-entry (with-temp-buffer
		      (insert new-entry)
		      (org-ref-clean-bibtex-entry)
		      (setq new-key (bibtex-key-in-head))
		      (buffer-string)))
    (find-file bibfile)
    (goto-char (point-min))
    (when (search-forward new-key nil t)
      (beep)
      (setq new-key (read-input
		     (format  "%s already exists. Enter new key (C-g to cancel): " new-key)
		     new-key)))
    (goto-char (point-max))
    (insert new-entry)
    ;; set key. It is simplest to just replace it, even if it is the same.
    (bibtex-beginning-of-entry)
    (re-search-forward bibtex-entry-maybe-empty-head)
    (if (match-beginning bibtex-key-in-head)
	(delete-region (match-beginning bibtex-key-in-head)
		       (match-end bibtex-key-in-head)))
    (insert new-key)
    (bibtex-fill-entry)
    (save-buffer)))
#+END_SRC



* end of file
#+BEGIN_SRC emacs-lisp :tangle doi-utils.el
(provide 'doi-utils)
#+END_SRC
* load
#+BEGIN_SRC emacs-lisp :tangle no
(org-babel-load-file "doi-utils.org")
#+END_SRC

#+RESULTS:
: Loaded doi-utils.el





#+BEGIN_SRC emacs-lisp
(setq data '(("John" . "john@email.com")
             ("Jim" . "jim@email.com")
             ("Jane" . "jane@email.com")
             ("Jill" . "jill@email.com")))

(setq some-helm-source
      `((name . "HELM at the Emacs")
        (candidates . ,(mapcar 'car data))
        (action . (lambda (candidate)
                    (message-box "%s" (cdr (assoc candidate data)))))))

(message-box "you chose %s" (helm :sources '(some-helm-source)))
#+END_SRC

#+RESULTS:
: you chose jim@email.com
